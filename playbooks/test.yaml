- hosts: all
  tasks:
    - name: List files on the Executor (where the code is)
      find:
        paths: "{{ zuul.project.src_dir }}"
      register: repo_files
      delegate_to: localhost

    - name: Show me the files
      debug:
        msg: "Zuul sees these files: {{ repo_files.files | map(attribute='path') | map('basename') | list }}"

    - name: Ensure README.md is GONE
      stat:
        path: "{{ zuul.project.src_dir }}/README.md"
      register: old_readme
      delegate_to: localhost

    - name: Check for the new README.txt
      stat:
        path: "{{ zuul.project.src_dir }}/README.txt"
      register: new_readme
      delegate_to: localhost

    - name: Final Validation
      fail:
        msg: "Failure! Expected README.txt to exist and README.md to be gone."
      when: old_readme.stat.exists or not new_readme.stat.exists

    - name: Success Wait
      command: sleep 10
